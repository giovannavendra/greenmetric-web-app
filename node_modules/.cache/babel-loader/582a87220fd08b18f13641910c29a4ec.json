{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/giovanna/Documents/MC855/green-metric/web-app/src/pages/Dashboard.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, createRef } from 'react';\nimport { PieChart } from 'react-minimal-pie-chart';\nimport { Segment, Container, Breadcrumb, List, Button, Modal, Header, Icon, Sticky, Ref, Input, Form } from \"semantic-ui-react\";\nimport { Redirect } from 'react-router-dom';\nimport { calculate, editDashboard, deleteDashboard, createCategory, updateCategory, deleteCategory, listScore } from '../api/score';\nimport CategoryEditor from '../components/CategoryEditor';\nimport CategoryScore from '../components/CategoryScore';\nimport CategoryScoreLabel from '../components/CategoryScoreLabel';\nimport urls from \"../utils/urls\";\nimport { v4 as uuidv4 } from 'uuid';\n\nconst copyData = data => ({ ...data,\n  dashboard: { ...data.dashboard\n  },\n  categoryResults: data.categoryResults.map(el => ({ ...el,\n    category: { ...el.category,\n      metrics: [...el.category.metrics]\n    }\n  }))\n});\n\nconst Dashboard = ({\n  id\n}) => {\n  _s();\n\n  const contextRef = /*#__PURE__*/createRef();\n  const refToScroll = /*#__PURE__*/createRef();\n  const nameInputRef = /*#__PURE__*/createRef();\n  const formRef = /*#__PURE__*/createRef();\n  const [scoreOptions, setScoreOptions] = useState([]);\n  const [state, setState] = useState({\n    open: false,\n    redirect: false,\n    editing: false,\n    processing: false,\n    loading: true,\n    data: null,\n    viewData: null,\n    scrollRef: false,\n    removedCategories: []\n  });\n  const {\n    open,\n    redirect,\n    processing,\n    data,\n    viewData,\n    loading,\n    editing,\n    scrollRef,\n    removedCategories\n  } = state;\n\n  const fetchScore = () => {\n    calculate(id).then(response => {\n      setState({ ...state,\n        data: response.data,\n        loading: false,\n        processing: false,\n        editing: false\n      });\n    }).catch(() => {\n      setState({ ...state,\n        loading: false,\n        processing: false,\n        editing: false\n      });\n    });\n  };\n\n  useEffect(() => {\n    fetchScore();\n    listScore().then(response => {\n      setScoreOptions(response.data);\n    });\n  }, []);\n  useEffect(() => {\n    if (scrollRef) {\n      refToScroll.current.scrollIntoView({\n        behavior: 'smooth',\n        block: 'center'\n      });\n    }\n  }, [scrollRef]);\n  useEffect(() => {\n    if (!data) {\n      return;\n    }\n\n    setState({ ...state,\n      viewData: copyData(data)\n    });\n  }, [data]);\n\n  const handleDelete = () => {\n    setState({ ...state,\n      processing: true\n    });\n    Promise.all([...data.categoryResults.map(item => {\n      return deleteCategory(item.category.id);\n    }), deleteDashboard(id)]).then(() => {\n      setState({ ...state,\n        redirect: urls.dashboards\n      });\n    });\n  };\n\n  const handleRemoveCategory = i => {\n    const newCategories = [...state.viewData.categoryResults].map(el => {\n      if (el.category.order > i + 1) {\n        el.category.order--;\n      }\n\n      return el;\n    });\n    const removedCategory = newCategories.splice(i, 1)[0];\n\n    if (!removedCategory.category.isNew) {\n      removedCategories.push(removedCategory.category.id);\n      setState({ ...state,\n        viewData: { ...viewData,\n          categoryResults: newCategories\n        },\n        removedCategories\n      });\n    }\n  };\n\n  const handleAddCategory = () => {\n    const newCategories = [...state.viewData.categoryResults].map(el => {\n      el.category.order++;\n      return el;\n    });\n    newCategories.unshift({\n      category: {\n        isNew: true,\n        id: uuidv4(),\n        dashboard: id,\n        name: \"\",\n        color: \"\",\n        weight: 0,\n        order: 1,\n        metrics: []\n      },\n      value: 0,\n      total: 0,\n      metricResults: []\n    });\n    setState({ ...state,\n      viewData: { ...viewData,\n        categoryResults: newCategories\n      },\n      scrollRef: 0\n    });\n  };\n\n  const handleUpdate = async () => {\n    setState({ ...state,\n      processing: true\n    });\n    const newName = nameInputRef.current.inputRef.current.value;\n    const promises = viewData.categoryResults.map(result => {\n      const {\n        isNew,\n        ...category\n      } = result.category;\n\n      if (isNew) {\n        return createCategory(category);\n      }\n\n      return updateCategory(category.id, category);\n    });\n    removedCategories.map(id => {\n      deleteCategory(id);\n    });\n\n    if (data.dashboard.name != newName) {\n      promises.push(editDashboard(id, newName));\n    }\n\n    try {\n      await Promise.all(promises);\n    } finally {\n      fetchScore();\n    }\n  };\n\n  const handleUpdateCancel = () => {\n    setState({ ...state,\n      editing: false,\n      viewData: copyData(data)\n    });\n  };\n\n  const handleOrderUp = i => {\n    const newCategory = [...state.viewData.categoryResults];\n    newCategory[i].category.order--;\n    newCategory[i + 1].category.order++;\n    newCategory[i] = newCategory.splice(i - 1, 1, newCategory[i])[0];\n    setState({ ...state,\n      viewData: { ...viewData,\n        categoryResults: newCategory\n      },\n      scrollRef: i - 1\n    });\n  };\n\n  const handleOrderDown = i => {\n    const newCategory = [...state.viewData.categoryResults];\n    newCategory[i].category.order++;\n    newCategory[i + 1].category.order--;\n    newCategory[i] = newCategory.splice(i + 1, 1, newCategory[i])[0];\n    setState({ ...state,\n      viewData: { ...viewData,\n        categoryResults: newCategory\n      },\n      scrollRef: i + 1\n    });\n  };\n\n  const handleChangeCategory = (i, newData) => {\n    const newCategories = viewData.categoryResults;\n    newCategories[i] = { ...newCategories[i],\n      category: { ...newData\n      }\n    };\n    setState({ ...state,\n      viewData: { ...viewData,\n        categoryResults: [...newCategories]\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(Container, {\n    children: [redirect && /*#__PURE__*/_jsxDEV(Redirect, {\n      to: redirect\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 20\n    }, this), /*#__PURE__*/_jsxDEV(Ref, {\n      innerRef: contextRef,\n      children: /*#__PURE__*/_jsxDEV(Segment.Group, {\n        children: [/*#__PURE__*/_jsxDEV(Sticky, {\n          context: contextRef,\n          offset: 80,\n          children: /*#__PURE__*/_jsxDEV(Segment, {\n            children: [/*#__PURE__*/_jsxDEV(Breadcrumb, {\n              size: \"massive\",\n              style: {\n                height: 36,\n                lineHeight: 1.4\n              },\n              children: [/*#__PURE__*/_jsxDEV(Breadcrumb.Section, {\n                href: urls.dashboards,\n                children: \"Pain\\xE9is\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 232,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Breadcrumb.Divider, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 233,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Breadcrumb.Section, {\n                active: true,\n                children: id\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 234,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 231,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              style: {\n                float: \"right\"\n              },\n              hidden: editing,\n              children: [/*#__PURE__*/_jsxDEV(Button, {\n                icon: \"pencil\",\n                basic: true,\n                onClick: () => setState({ ...state,\n                  editing: true\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 237,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                icon: \"trash\",\n                basic: true,\n                onClick: () => setState({ ...state,\n                  open: true\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 238,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 236,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              style: {\n                float: \"right\"\n              },\n              hidden: !editing,\n              children: [/*#__PURE__*/_jsxDEV(Button, {\n                icon: \"cancel\",\n                negative: true,\n                basic: true,\n                onClick: handleUpdateCancel,\n                disabled: processing\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 241,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                icon: \"check\",\n                positive: true,\n                basic: true,\n                onClick: handleUpdate,\n                loading: processing\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 242,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 240,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 230,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Segment, {\n          padded: true,\n          loading: loading || processing,\n          children: viewData && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: \"flex\",\n                alignItems: \"center\",\n                flexDirection: \"column\",\n                marginBottom: 50\n              },\n              children: [editing ? /*#__PURE__*/_jsxDEV(Input, {\n                name: \"name\",\n                defaultValue: viewData.dashboard.name,\n                style: {\n                  flexGrow: 0,\n                  marginBottom: 8\n                },\n                ref: nameInputRef\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 250,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(Header, {\n                content: viewData.dashboard.name,\n                size: \"huge\",\n                textAlign: \"center\",\n                as: \"h2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 252,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(PieChart, {\n                rounded: true,\n                lineWidth: \"20\",\n                animate: true,\n                data: [{\n                  value: viewData.value,\n                  color: 'blue'\n                }],\n                totalValue: viewData.total,\n                label: props => /*#__PURE__*/_jsxDEV(CategoryScoreLabel, { ...props,\n                  color: \"blue\",\n                  header: viewData.value,\n                  subheader: `/ ${viewData.total}`\n                }, id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 260,\n                  columnNumber: 37\n                }, this),\n                labelPosition: 0,\n                background: \"#bfbfbf\",\n                lengthAngle: 270,\n                startAngle: 135,\n                viewBoxSize: [100, 87],\n                style: {\n                  maxWidth: 250\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 254,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 248,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Form, {\n              ref: formRef,\n              children: /*#__PURE__*/_jsxDEV(List, {\n                relaxed: \"very\",\n                children: [editing && /*#__PURE__*/_jsxDEV(List.Item, {\n                  style: {\n                    display: \"flex\",\n                    justifyContent: \"center\"\n                  },\n                  children: /*#__PURE__*/_jsxDEV(Button, {\n                    content: \"Adicionar categoria\",\n                    icon: \"plus\",\n                    primary: true,\n                    basic: true,\n                    labelPosition: \"left\",\n                    onClick: handleAddCategory\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 272,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 271,\n                  columnNumber: 31\n                }, this), viewData.categoryResults.map((result, i, arr) => result && /*#__PURE__*/_jsxDEV(List.Item, {\n                  style: {\n                    paddingLeft: editing ? 0 : 80\n                  },\n                  children: /*#__PURE__*/_jsxDEV(Ref, {\n                    innerRef: i == scrollRef ? refToScroll : undefined,\n                    children: /*#__PURE__*/_jsxDEV(_Fragment, {\n                      children: [editing && /*#__PURE__*/_jsxDEV(\"div\", {\n                        style: {\n                          paddingRight: 15,\n                          marginTop: 20,\n                          float: \"left\",\n                          display: \"flex\",\n                          flexDirection: \"column\",\n                          alignItems: \"center\"\n                        },\n                        children: [/*#__PURE__*/_jsxDEV(Button.Group, {\n                          children: [/*#__PURE__*/_jsxDEV(Button, {\n                            icon: \"angle up\",\n                            onClick: () => handleOrderUp(i),\n                            disabled: i == 0\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 280,\n                            columnNumber: 31\n                          }, this), /*#__PURE__*/_jsxDEV(Button.Or, {\n                            text: i + 1\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 281,\n                            columnNumber: 31\n                          }, this), /*#__PURE__*/_jsxDEV(Button, {\n                            icon: \"angle down\",\n                            onClick: () => handleOrderDown(i),\n                            disabled: i == arr.length - 1\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 282,\n                            columnNumber: 31\n                          }, this)]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 279,\n                          columnNumber: 29\n                        }, this), /*#__PURE__*/_jsxDEV(Button, {\n                          icon: \"trash\",\n                          style: {\n                            margin: 5\n                          },\n                          onClick: () => handleRemoveCategory(i)\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 284,\n                          columnNumber: 29\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 278,\n                        columnNumber: 39\n                      }, this), editing ? /*#__PURE__*/_jsxDEV(CategoryEditor, {\n                        data: result,\n                        onChange: data => handleChangeCategory(i, data),\n                        options: scoreOptions\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 286,\n                        columnNumber: 38\n                      }, this) : /*#__PURE__*/_jsxDEV(CategoryScore, {\n                        data: result,\n                        editable: editing,\n                        onEdit: () => handleClickEditCategory(i)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 287,\n                        columnNumber: 29\n                      }, this)]\n                    }, void 0, true)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 276,\n                    columnNumber: 23\n                  }, this)\n                }, result.category.id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 275,\n                  columnNumber: 21\n                }, this))]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 270,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 269,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      open: open,\n      size: \"tiny\",\n      children: [/*#__PURE__*/_jsxDEV(Header, {\n        icon: true,\n        children: [/*#__PURE__*/_jsxDEV(Icon, {\n          name: \"trash\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 299,\n          columnNumber: 22\n        }, this), \"Remover Painel\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Content, {\n        children: [\"Deseja excluir o Painel \\\"\", id, \"\\\"\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Actions, {\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          basic: true,\n          onClick: () => setState({ ...state,\n            open: false\n          }),\n          disabled: processing,\n          children: [/*#__PURE__*/_jsxDEV(Icon, {\n            name: \"remove\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 303,\n            columnNumber: 13\n          }, this), \" Cancelar\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 302,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          primary: true,\n          onClick: () => handleDelete(),\n          loading: processing,\n          children: [/*#__PURE__*/_jsxDEV(Icon, {\n            name: \"checkmark\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 306,\n            columnNumber: 13\n          }, this), \" Sim\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 305,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 298,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 225,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Dashboard, \"M7l0cPWAblOQoouQQDpYPtz0Rug=\");\n\n_c = Dashboard;\nexport default Dashboard;\n\nvar _c;\n\n$RefreshReg$(_c, \"Dashboard\");","map":{"version":3,"sources":["/Users/giovanna/Documents/MC855/green-metric/web-app/src/pages/Dashboard.jsx"],"names":["React","useState","useEffect","createRef","PieChart","Segment","Container","Breadcrumb","List","Button","Modal","Header","Icon","Sticky","Ref","Input","Form","Redirect","calculate","editDashboard","deleteDashboard","createCategory","updateCategory","deleteCategory","listScore","CategoryEditor","CategoryScore","CategoryScoreLabel","urls","v4","uuidv4","copyData","data","dashboard","categoryResults","map","el","category","metrics","Dashboard","id","contextRef","refToScroll","nameInputRef","formRef","scoreOptions","setScoreOptions","state","setState","open","redirect","editing","processing","loading","viewData","scrollRef","removedCategories","fetchScore","then","response","catch","current","scrollIntoView","behavior","block","handleDelete","Promise","all","item","dashboards","handleRemoveCategory","i","newCategories","order","removedCategory","splice","isNew","push","handleAddCategory","unshift","name","color","weight","value","total","metricResults","handleUpdate","newName","inputRef","promises","result","handleUpdateCancel","handleOrderUp","newCategory","handleOrderDown","handleChangeCategory","newData","height","lineHeight","float","display","alignItems","flexDirection","marginBottom","flexGrow","props","maxWidth","justifyContent","arr","paddingLeft","undefined","paddingRight","marginTop","length","margin","handleClickEditCategory"],"mappings":";;;;;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,SAArC,QAAsD,OAAtD;AACA,SAASC,QAAT,QAAyB,yBAAzB;AACA,SAASC,OAAT,EAAkBC,SAAlB,EAA6BC,UAA7B,EAAyCC,IAAzC,EAA+CC,MAA/C,EAAuDC,KAAvD,EAA8DC,MAA9D,EAAsEC,IAAtE,EAA4EC,MAA5E,EAAoFC,GAApF,EAAyFC,KAAzF,EAAgGC,IAAhG,QAA4G,mBAA5G;AACA,SAASC,QAAT,QAAyB,kBAAzB;AACA,SAASC,SAAT,EAAoBC,aAApB,EAAmCC,eAAnC,EAAoDC,cAApD,EAAoEC,cAApE,EAAoFC,cAApF,EAAoGC,SAApG,QAAqH,cAArH;AACA,OAAOC,cAAP,MAA2B,8BAA3B;AACA,OAAOC,aAAP,MAA0B,6BAA1B;AACA,OAAOC,kBAAP,MAA+B,kCAA/B;AACA,OAAOC,IAAP,MAAiB,eAAjB;AACA,SAASC,EAAE,IAAIC,MAAf,QAA6B,MAA7B;;AAEA,MAAMC,QAAQ,GAAGC,IAAI,KACnB,EACE,GAAGA,IADL;AAEEC,EAAAA,SAAS,EAAE,EAAE,GAAGD,IAAI,CAACC;AAAV,GAFb;AAGEC,EAAAA,eAAe,EAAEF,IAAI,CAACE,eAAL,CAAqBC,GAArB,CAAyBC,EAAE,KAAK,EAC/C,GAAGA,EAD4C;AAE/CC,IAAAA,QAAQ,EAAE,EACR,GAAGD,EAAE,CAACC,QADE;AAERC,MAAAA,OAAO,EAAE,CAAC,GAAGF,EAAE,CAACC,QAAH,CAAYC,OAAhB;AAFD;AAFqC,GAAL,CAA3B;AAHnB,CADmB,CAArB;;AAcA,MAAMC,SAAS,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAY;AAAA;;AAC5B,QAAMC,UAAU,gBAAGtC,SAAS,EAA5B;AACA,QAAMuC,WAAW,gBAAGvC,SAAS,EAA7B;AACA,QAAMwC,YAAY,gBAAGxC,SAAS,EAA9B;AACA,QAAMyC,OAAO,gBAAGzC,SAAS,EAAzB;AACA,QAAM,CAAE0C,YAAF,EAAgBC,eAAhB,IAAoC7C,QAAQ,CAAC,EAAD,CAAlD;AACA,QAAM,CAAC8C,KAAD,EAAQC,QAAR,IAAoB/C,QAAQ,CAAC;AACjCgD,IAAAA,IAAI,EAAE,KAD2B;AAEjCC,IAAAA,QAAQ,EAAE,KAFuB;AAGjCC,IAAAA,OAAO,EAAE,KAHwB;AAIjCC,IAAAA,UAAU,EAAE,KAJqB;AAKjCC,IAAAA,OAAO,EAAE,IALwB;AAMjCrB,IAAAA,IAAI,EAAE,IAN2B;AAOjCsB,IAAAA,QAAQ,EAAE,IAPuB;AAQjCC,IAAAA,SAAS,EAAE,KARsB;AASjCC,IAAAA,iBAAiB,EAAE;AATc,GAAD,CAAlC;AAWA,QAAM;AAAEP,IAAAA,IAAF;AAAQC,IAAAA,QAAR;AAAkBE,IAAAA,UAAlB;AAA8BpB,IAAAA,IAA9B;AAAoCsB,IAAAA,QAApC;AAA8CD,IAAAA,OAA9C;AAAuDF,IAAAA,OAAvD;AAAgEI,IAAAA,SAAhE;AAA2EC,IAAAA;AAA3E,MAAiGT,KAAvG;;AAEA,QAAMU,UAAU,GAAG,MAAM;AACvBvC,IAAAA,SAAS,CAACsB,EAAD,CAAT,CACGkB,IADH,CACQC,QAAQ,IAAI;AAChBX,MAAAA,QAAQ,CAAC,EAAE,GAAGD,KAAL;AAAYf,QAAAA,IAAI,EAAE2B,QAAQ,CAAC3B,IAA3B;AAAiCqB,QAAAA,OAAO,EAAE,KAA1C;AAAiDD,QAAAA,UAAU,EAAE,KAA7D;AAAoED,QAAAA,OAAO,EAAE;AAA7E,OAAD,CAAR;AACD,KAHH,EAIGS,KAJH,CAIS,MAAM;AACXZ,MAAAA,QAAQ,CAAC,EAAE,GAAGD,KAAL;AAAYM,QAAAA,OAAO,EAAE,KAArB;AAA4BD,QAAAA,UAAU,EAAE,KAAxC;AAA+CD,QAAAA,OAAO,EAAE;AAAxD,OAAD,CAAR;AACD,KANH;AAOD,GARD;;AAUAjD,EAAAA,SAAS,CAAC,MAAM;AACduD,IAAAA,UAAU;AACVjC,IAAAA,SAAS,GAAGkC,IAAZ,CAAiBC,QAAQ,IAAI;AAC3Bb,MAAAA,eAAe,CAACa,QAAQ,CAAC3B,IAAV,CAAf;AACD,KAFD;AAGD,GALQ,EAKN,EALM,CAAT;AAOA9B,EAAAA,SAAS,CAAC,MAAM;AACd,QAAIqD,SAAJ,EAAe;AACbb,MAAAA,WAAW,CAACmB,OAAZ,CAAoBC,cAApB,CAAmC;AAAEC,QAAAA,QAAQ,EAAE,QAAZ;AAAsBC,QAAAA,KAAK,EAAE;AAA7B,OAAnC;AACD;AACF,GAJQ,EAIN,CAACT,SAAD,CAJM,CAAT;AAMArD,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI,CAAC8B,IAAL,EAAW;AACT;AACD;;AAEDgB,IAAAA,QAAQ,CAAC,EAAE,GAAGD,KAAL;AAAYO,MAAAA,QAAQ,EAAEvB,QAAQ,CAACC,IAAD;AAA9B,KAAD,CAAR;AACD,GANQ,EAMN,CAACA,IAAD,CANM,CAAT;;AAQA,QAAMiC,YAAY,GAAG,MAAM;AACzBjB,IAAAA,QAAQ,CAAC,EAAE,GAAGD,KAAL;AAAYK,MAAAA,UAAU,EAAE;AAAxB,KAAD,CAAR;AACAc,IAAAA,OAAO,CAACC,GAAR,CAAY,CACV,GAAGnC,IAAI,CAACE,eAAL,CAAqBC,GAArB,CAAyBiC,IAAI,IAAI;AAClC,aAAO7C,cAAc,CAAC6C,IAAI,CAAC/B,QAAL,CAAcG,EAAf,CAArB;AACD,KAFE,CADO,EAIVpB,eAAe,CAACoB,EAAD,CAJL,CAAZ,EAMGkB,IANH,CAMQ,MAAM;AACVV,MAAAA,QAAQ,CAAC,EAAE,GAAGD,KAAL;AAAYG,QAAAA,QAAQ,EAAEtB,IAAI,CAACyC;AAA3B,OAAD,CAAR;AACD,KARH;AASD,GAXD;;AAaA,QAAMC,oBAAoB,GAAIC,CAAD,IAAO;AAClC,UAAMC,aAAa,GAAG,CAAC,GAAGzB,KAAK,CAACO,QAAN,CAAepB,eAAnB,EAAoCC,GAApC,CAAwCC,EAAE,IAAI;AAClE,UAAIA,EAAE,CAACC,QAAH,CAAYoC,KAAZ,GAAoBF,CAAC,GAAG,CAA5B,EAA+B;AAC7BnC,QAAAA,EAAE,CAACC,QAAH,CAAYoC,KAAZ;AACD;;AAED,aAAOrC,EAAP;AACD,KANqB,CAAtB;AAQA,UAAMsC,eAAe,GAAGF,aAAa,CAACG,MAAd,CAAqBJ,CAArB,EAAwB,CAAxB,EAA2B,CAA3B,CAAxB;;AACA,QAAI,CAACG,eAAe,CAACrC,QAAhB,CAAyBuC,KAA9B,EAAqC;AACnCpB,MAAAA,iBAAiB,CAACqB,IAAlB,CAAuBH,eAAe,CAACrC,QAAhB,CAAyBG,EAAhD;AACAQ,MAAAA,QAAQ,CAAC,EACP,GAAGD,KADI;AAEPO,QAAAA,QAAQ,EAAE,EACR,GAAGA,QADK;AAERpB,UAAAA,eAAe,EAAEsC;AAFT,SAFH;AAMPhB,QAAAA;AANO,OAAD,CAAR;AAQD;AACF,GArBD;;AAuBA,QAAMsB,iBAAiB,GAAG,MAAM;AAC9B,UAAMN,aAAa,GAAG,CAAC,GAAGzB,KAAK,CAACO,QAAN,CAAepB,eAAnB,EAAoCC,GAApC,CAAwCC,EAAE,IAAI;AAClEA,MAAAA,EAAE,CAACC,QAAH,CAAYoC,KAAZ;AACA,aAAOrC,EAAP;AACD,KAHqB,CAAtB;AAIAoC,IAAAA,aAAa,CAACO,OAAd,CAAsB;AACpB1C,MAAAA,QAAQ,EAAE;AACRuC,QAAAA,KAAK,EAAE,IADC;AAERpC,QAAAA,EAAE,EAAEV,MAAM,EAFF;AAGRG,QAAAA,SAAS,EAAEO,EAHH;AAIRwC,QAAAA,IAAI,EAAE,EAJE;AAKRC,QAAAA,KAAK,EAAE,EALC;AAMRC,QAAAA,MAAM,EAAE,CANA;AAORT,QAAAA,KAAK,EAAE,CAPC;AAQRnC,QAAAA,OAAO,EAAE;AARD,OADU;AAWpB6C,MAAAA,KAAK,EAAE,CAXa;AAYpBC,MAAAA,KAAK,EAAE,CAZa;AAapBC,MAAAA,aAAa,EAAE;AAbK,KAAtB;AAiBArC,IAAAA,QAAQ,CAAC,EACP,GAAGD,KADI;AAEPO,MAAAA,QAAQ,EAAE,EACR,GAAGA,QADK;AAERpB,QAAAA,eAAe,EAAEsC;AAFT,OAFH;AAMPjB,MAAAA,SAAS,EAAE;AANJ,KAAD,CAAR;AAQD,GA9BD;;AAgCA,QAAM+B,YAAY,GAAG,YAAY;AAC/BtC,IAAAA,QAAQ,CAAC,EAAE,GAAGD,KAAL;AAAYK,MAAAA,UAAU,EAAE;AAAxB,KAAD,CAAR;AACA,UAAMmC,OAAO,GAAG5C,YAAY,CAACkB,OAAb,CAAqB2B,QAArB,CAA8B3B,OAA9B,CAAsCsB,KAAtD;AACA,UAAMM,QAAQ,GAAGnC,QAAQ,CAACpB,eAAT,CAAyBC,GAAzB,CAA6BuD,MAAM,IAAI;AACtD,YAAM;AAAEd,QAAAA,KAAF;AAAS,WAAGvC;AAAZ,UAAyBqD,MAAM,CAACrD,QAAtC;;AACA,UAAIuC,KAAJ,EAAW;AACT,eAAOvD,cAAc,CAACgB,QAAD,CAArB;AACD;;AAED,aAAOf,cAAc,CAACe,QAAQ,CAACG,EAAV,EAAcH,QAAd,CAArB;AACD,KAPgB,CAAjB;AASAmB,IAAAA,iBAAiB,CAACrB,GAAlB,CAAsBK,EAAE,IAAI;AAC1BjB,MAAAA,cAAc,CAACiB,EAAD,CAAd;AACD,KAFD;;AAIA,QAAIR,IAAI,CAACC,SAAL,CAAe+C,IAAf,IAAuBO,OAA3B,EAAoC;AAClCE,MAAAA,QAAQ,CAACZ,IAAT,CAAc1D,aAAa,CAACqB,EAAD,EAAK+C,OAAL,CAA3B;AACD;;AAED,QAAI;AACF,YAAMrB,OAAO,CAACC,GAAR,CAAYsB,QAAZ,CAAN;AACD,KAFD,SAEU;AACRhC,MAAAA,UAAU;AACX;AACF,GAzBD;;AA2BA,QAAMkC,kBAAkB,GAAG,MAAM;AAC/B3C,IAAAA,QAAQ,CAAC,EAAE,GAAGD,KAAL;AAAYI,MAAAA,OAAO,EAAE,KAArB;AAA4BG,MAAAA,QAAQ,EAAEvB,QAAQ,CAACC,IAAD;AAA9C,KAAD,CAAR;AACD,GAFD;;AAIA,QAAM4D,aAAa,GAAIrB,CAAD,IAAO;AAC3B,UAAMsB,WAAW,GAAG,CAAC,GAAG9C,KAAK,CAACO,QAAN,CAAepB,eAAnB,CAApB;AACA2D,IAAAA,WAAW,CAACtB,CAAD,CAAX,CAAelC,QAAf,CAAwBoC,KAAxB;AACAoB,IAAAA,WAAW,CAACtB,CAAC,GAAG,CAAL,CAAX,CAAmBlC,QAAnB,CAA4BoC,KAA5B;AACAoB,IAAAA,WAAW,CAACtB,CAAD,CAAX,GAAiBsB,WAAW,CAAClB,MAAZ,CAAmBJ,CAAC,GAAG,CAAvB,EAA0B,CAA1B,EAA6BsB,WAAW,CAACtB,CAAD,CAAxC,EAA6C,CAA7C,CAAjB;AACAvB,IAAAA,QAAQ,CAAC,EACP,GAAGD,KADI;AAEPO,MAAAA,QAAQ,EAAE,EACR,GAAGA,QADK;AAERpB,QAAAA,eAAe,EAAE2D;AAFT,OAFH;AAMPtC,MAAAA,SAAS,EAAEgB,CAAC,GAAG;AANR,KAAD,CAAR;AAQD,GAbD;;AAeA,QAAMuB,eAAe,GAAIvB,CAAD,IAAO;AAC7B,UAAMsB,WAAW,GAAG,CAAC,GAAG9C,KAAK,CAACO,QAAN,CAAepB,eAAnB,CAApB;AACA2D,IAAAA,WAAW,CAACtB,CAAD,CAAX,CAAelC,QAAf,CAAwBoC,KAAxB;AACAoB,IAAAA,WAAW,CAACtB,CAAC,GAAG,CAAL,CAAX,CAAmBlC,QAAnB,CAA4BoC,KAA5B;AACAoB,IAAAA,WAAW,CAACtB,CAAD,CAAX,GAAiBsB,WAAW,CAAClB,MAAZ,CAAmBJ,CAAC,GAAG,CAAvB,EAA0B,CAA1B,EAA6BsB,WAAW,CAACtB,CAAD,CAAxC,EAA6C,CAA7C,CAAjB;AACAvB,IAAAA,QAAQ,CAAC,EACP,GAAGD,KADI;AAEPO,MAAAA,QAAQ,EAAE,EACR,GAAGA,QADK;AAERpB,QAAAA,eAAe,EAAE2D;AAFT,OAFH;AAMPtC,MAAAA,SAAS,EAAEgB,CAAC,GAAG;AANR,KAAD,CAAR;AAQD,GAbD;;AAeA,QAAMwB,oBAAoB,GAAG,CAACxB,CAAD,EAAIyB,OAAJ,KAAgB;AAC3C,UAAMxB,aAAa,GAAGlB,QAAQ,CAACpB,eAA/B;AACAsC,IAAAA,aAAa,CAACD,CAAD,CAAb,GAAmB,EACjB,GAAGC,aAAa,CAACD,CAAD,CADC;AAEjBlC,MAAAA,QAAQ,EAAE,EACR,GAAG2D;AADK;AAFO,KAAnB;AAMAhD,IAAAA,QAAQ,CAAC,EACP,GAAGD,KADI;AAEPO,MAAAA,QAAQ,EAAE,EACR,GAAGA,QADK;AAERpB,QAAAA,eAAe,EAAE,CACf,GAAGsC,aADY;AAFT;AAFH,KAAD,CAAR;AASD,GAjBD;;AAmBA,sBACE,QAAC,SAAD;AAAA,eACGtB,QAAQ,iBAAI,QAAC,QAAD;AAAU,MAAA,EAAE,EAAEA;AAAd;AAAA;AAAA;AAAA;AAAA,YADf,eAEE,QAAC,GAAD;AAAK,MAAA,QAAQ,EAAET,UAAf;AAAA,6BACE,QAAC,OAAD,CAAS,KAAT;AAAA,gCACE,QAAC,MAAD;AAAQ,UAAA,OAAO,EAAEA,UAAjB;AAA6B,UAAA,MAAM,EAAE,EAArC;AAAA,iCACE,QAAC,OAAD;AAAA,oCACE,QAAC,UAAD;AAAY,cAAA,IAAI,EAAC,SAAjB;AAA2B,cAAA,KAAK,EAAE;AAAEwD,gBAAAA,MAAM,EAAE,EAAV;AAAcC,gBAAAA,UAAU,EAAE;AAA1B,eAAlC;AAAA,sCACE,QAAC,UAAD,CAAY,OAAZ;AAAoB,gBAAA,IAAI,EAAEtE,IAAI,CAACyC,UAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,eAEE,QAAC,UAAD,CAAY,OAAZ;AAAA;AAAA;AAAA;AAAA,sBAFF,eAGE,QAAC,UAAD,CAAY,OAAZ;AAAoB,gBAAA,MAAM,MAA1B;AAAA,0BAA4B7B;AAA5B;AAAA;AAAA;AAAA;AAAA,sBAHF;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,eAME;AAAM,cAAA,KAAK,EAAE;AAAE2D,gBAAAA,KAAK,EAAE;AAAT,eAAb;AAAiC,cAAA,MAAM,EAAEhD,OAAzC;AAAA,sCACE,QAAC,MAAD;AAAQ,gBAAA,IAAI,EAAC,QAAb;AAAsB,gBAAA,KAAK,MAA3B;AAA4B,gBAAA,OAAO,EAAE,MAAMH,QAAQ,CAAC,EAAE,GAAGD,KAAL;AAAYI,kBAAAA,OAAO,EAAE;AAArB,iBAAD;AAAnD;AAAA;AAAA;AAAA;AAAA,sBADF,eAEE,QAAC,MAAD;AAAQ,gBAAA,IAAI,EAAC,OAAb;AAAqB,gBAAA,KAAK,MAA1B;AAA2B,gBAAA,OAAO,EAAE,MAAMH,QAAQ,CAAC,EAAE,GAAGD,KAAL;AAAYE,kBAAAA,IAAI,EAAE;AAAlB,iBAAD;AAAlD;AAAA;AAAA;AAAA;AAAA,sBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,oBANF,eAUE;AAAM,cAAA,KAAK,EAAE;AAAEkD,gBAAAA,KAAK,EAAE;AAAT,eAAb;AAAiC,cAAA,MAAM,EAAE,CAAChD,OAA1C;AAAA,sCACE,QAAC,MAAD;AAAQ,gBAAA,IAAI,EAAC,QAAb;AAAsB,gBAAA,QAAQ,MAA9B;AAA+B,gBAAA,KAAK,MAApC;AAAqC,gBAAA,OAAO,EAAEwC,kBAA9C;AAAkE,gBAAA,QAAQ,EAAEvC;AAA5E;AAAA;AAAA;AAAA;AAAA,sBADF,eAEE,QAAC,MAAD;AAAQ,gBAAA,IAAI,EAAC,OAAb;AAAqB,gBAAA,QAAQ,MAA7B;AAA8B,gBAAA,KAAK,MAAnC;AAAoC,gBAAA,OAAO,EAAEkC,YAA7C;AAA2D,gBAAA,OAAO,EAAElC;AAApE;AAAA;AAAA;AAAA;AAAA,sBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,oBAVF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBADF,eAkBE,QAAC,OAAD;AAAS,UAAA,MAAM,MAAf;AAAgB,UAAA,OAAO,EAAEC,OAAO,IAAID,UAApC;AAAA,oBACGE,QAAQ,iBAAI;AAAA,oCACX;AAAK,cAAA,KAAK,EAAE;AAAE8C,gBAAAA,OAAO,EAAE,MAAX;AAAmBC,gBAAAA,UAAU,EAAE,QAA/B;AAAyCC,gBAAAA,aAAa,EAAE,QAAxD;AAAkEC,gBAAAA,YAAY,EAAE;AAAhF,eAAZ;AAAA,yBACGpD,OAAO,gBACN,QAAC,KAAD;AAAO,gBAAA,IAAI,EAAC,MAAZ;AAAmB,gBAAA,YAAY,EAAEG,QAAQ,CAACrB,SAAT,CAAmB+C,IAApD;AAA0D,gBAAA,KAAK,EAAE;AAAEwB,kBAAAA,QAAQ,EAAE,CAAZ;AAAeD,kBAAAA,YAAY,EAAE;AAA7B,iBAAjE;AAAmG,gBAAA,GAAG,EAAE5D;AAAxG;AAAA;AAAA;AAAA;AAAA,sBADM,gBAGN,QAAC,MAAD;AAAQ,gBAAA,OAAO,EAAEW,QAAQ,CAACrB,SAAT,CAAmB+C,IAApC;AAA0C,gBAAA,IAAI,EAAC,MAA/C;AAAsD,gBAAA,SAAS,EAAC,QAAhE;AAAyE,gBAAA,EAAE,EAAC;AAA5E;AAAA;AAAA;AAAA;AAAA,sBAJJ,eAME,QAAC,QAAD;AACE,gBAAA,OAAO,MADT;AAEE,gBAAA,SAAS,EAAC,IAFZ;AAGE,gBAAA,OAAO,MAHT;AAIE,gBAAA,IAAI,EAAE,CAAC;AAAEG,kBAAAA,KAAK,EAAE7B,QAAQ,CAAC6B,KAAlB;AAAyBF,kBAAAA,KAAK,EAAE;AAAhC,iBAAD,CAJR;AAKE,gBAAA,UAAU,EAAE3B,QAAQ,CAAC8B,KALvB;AAME,gBAAA,KAAK,EAAGqB,KAAD,iBAAW,QAAC,kBAAD,OAAiCA,KAAjC;AAAwC,kBAAA,KAAK,EAAC,MAA9C;AAAqD,kBAAA,MAAM,EAAEnD,QAAQ,CAAC6B,KAAtE;AAA6E,kBAAA,SAAS,EAAG,KAAI7B,QAAQ,CAAC8B,KAAM;AAA5G,mBAAyB5C,EAAzB;AAAA;AAAA;AAAA;AAAA,wBANpB;AAOE,gBAAA,aAAa,EAAE,CAPjB;AAQE,gBAAA,UAAU,EAAC,SARb;AASE,gBAAA,WAAW,EAAE,GATf;AAUE,gBAAA,UAAU,EAAE,GAVd;AAWE,gBAAA,WAAW,EAAE,CAAC,GAAD,EAAM,EAAN,CAXf;AAYE,gBAAA,KAAK,EAAE;AAAEkE,kBAAAA,QAAQ,EAAE;AAAZ;AAZT;AAAA;AAAA;AAAA;AAAA,sBANF;AAAA;AAAA;AAAA;AAAA;AAAA,oBADW,eAsBX,QAAC,IAAD;AAAM,cAAA,GAAG,EAAE9D,OAAX;AAAA,qCACE,QAAC,IAAD;AAAM,gBAAA,OAAO,EAAC,MAAd;AAAA,2BACGO,OAAO,iBAAI,QAAC,IAAD,CAAM,IAAN;AAAW,kBAAA,KAAK,EAAE;AAAEiD,oBAAAA,OAAO,EAAE,MAAX;AAAmBO,oBAAAA,cAAc,EAAE;AAAnC,mBAAlB;AAAA,yCACV,QAAC,MAAD;AAAQ,oBAAA,OAAO,EAAC,qBAAhB;AAAsC,oBAAA,IAAI,EAAC,MAA3C;AAAkD,oBAAA,OAAO,MAAzD;AAA0D,oBAAA,KAAK,MAA/D;AAAgE,oBAAA,aAAa,EAAC,MAA9E;AAAqF,oBAAA,OAAO,EAAE7B;AAA9F;AAAA;AAAA;AAAA;AAAA;AADU;AAAA;AAAA;AAAA;AAAA,wBADd,EAIGxB,QAAQ,CAACpB,eAAT,CAAyBC,GAAzB,CAA6B,CAACuD,MAAD,EAASnB,CAAT,EAAYqC,GAAZ,KAAoBlB,MAAM,iBACtD,QAAC,IAAD,CAAM,IAAN;AAAoC,kBAAA,KAAK,EAAE;AAAEmB,oBAAAA,WAAW,EAAE1D,OAAO,GAAG,CAAH,GAAO;AAA7B,mBAA3C;AAAA,yCACE,QAAC,GAAD;AAAK,oBAAA,QAAQ,EAAEoB,CAAC,IAAIhB,SAAL,GAAiBb,WAAjB,GAA+BoE,SAA9C;AAAA,2CACE;AAAA,iCACG3D,OAAO,iBAAI;AAAK,wBAAA,KAAK,EAAE;AAAE4D,0BAAAA,YAAY,EAAE,EAAhB;AAAoBC,0BAAAA,SAAS,EAAE,EAA/B;AAAmCb,0BAAAA,KAAK,EAAE,MAA1C;AAAkDC,0BAAAA,OAAO,EAAE,MAA3D;AAAmEE,0BAAAA,aAAa,EAAE,QAAlF;AAA4FD,0BAAAA,UAAU,EAAE;AAAxG,yBAAZ;AAAA,gDACV,QAAC,MAAD,CAAQ,KAAR;AAAA,kDACE,QAAC,MAAD;AAAQ,4BAAA,IAAI,EAAC,UAAb;AAAwB,4BAAA,OAAO,EAAE,MAAMT,aAAa,CAACrB,CAAD,CAApD;AAAyD,4BAAA,QAAQ,EAAEA,CAAC,IAAI;AAAxE;AAAA;AAAA;AAAA;AAAA,kCADF,eAEE,QAAC,MAAD,CAAQ,EAAR;AAAW,4BAAA,IAAI,EAAEA,CAAC,GAAG;AAArB;AAAA;AAAA;AAAA;AAAA,kCAFF,eAGE,QAAC,MAAD;AAAQ,4BAAA,IAAI,EAAC,YAAb;AAA0B,4BAAA,OAAO,EAAE,MAAMuB,eAAe,CAACvB,CAAD,CAAxD;AAA6D,4BAAA,QAAQ,EAAEA,CAAC,IAAIqC,GAAG,CAACK,MAAJ,GAAa;AAAzF;AAAA;AAAA;AAAA;AAAA,kCAHF;AAAA;AAAA;AAAA;AAAA;AAAA,gCADU,eAMV,QAAC,MAAD;AAAQ,0BAAA,IAAI,EAAC,OAAb;AAAqB,0BAAA,KAAK,EAAE;AAAEC,4BAAAA,MAAM,EAAE;AAAV,2BAA5B;AAA2C,0BAAA,OAAO,EAAE,MAAM5C,oBAAoB,CAACC,CAAD;AAA9E;AAAA;AAAA;AAAA;AAAA,gCANU;AAAA;AAAA;AAAA;AAAA;AAAA,8BADd,EASGpB,OAAO,gBAAG,QAAC,cAAD;AAAgB,wBAAA,IAAI,EAAEuC,MAAtB;AAA8B,wBAAA,QAAQ,EAAE1D,IAAI,IAAI+D,oBAAoB,CAACxB,CAAD,EAAIvC,IAAJ,CAApE;AAA+E,wBAAA,OAAO,EAAEa;AAAxF;AAAA;AAAA;AAAA;AAAA,8BAAH,gBACN,QAAC,aAAD;AAAe,wBAAA,IAAI,EAAE6C,MAArB;AAA6B,wBAAA,QAAQ,EAAEvC,OAAvC;AAAgD,wBAAA,MAAM,EAAE,MAAMgE,uBAAuB,CAAC5C,CAAD;AAArF;AAAA;AAAA;AAAA;AAAA,8BAVJ;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF,mBAAgBmB,MAAM,CAACrD,QAAP,CAAgBG,EAAhC;AAAA;AAAA;AAAA;AAAA,wBADD,CAJH;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,oBAtBW;AAAA;AADf;AAAA;AAAA;AAAA;AAAA,gBAlBF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YAFF,eAyEE,QAAC,KAAD;AAAO,MAAA,IAAI,EAAES,IAAb;AAAmB,MAAA,IAAI,EAAC,MAAxB;AAAA,8BACE,QAAC,MAAD;AAAQ,QAAA,IAAI,MAAZ;AAAA,gCAAa,QAAC,IAAD;AAAM,UAAA,IAAI,EAAC;AAAX;AAAA;AAAA;AAAA;AAAA,gBAAb;AAAA;AAAA;AAAA;AAAA;AAAA,cADF,eAEE,QAAC,KAAD,CAAO,OAAP;AAAA,iDAAyCT,EAAzC;AAAA;AAAA;AAAA;AAAA;AAAA,cAFF,eAGE,QAAC,KAAD,CAAO,OAAP;AAAA,gCACE,QAAC,MAAD;AAAQ,UAAA,KAAK,MAAb;AAAc,UAAA,OAAO,EAAE,MAAMQ,QAAQ,CAAC,EAAE,GAAGD,KAAL;AAAYE,YAAAA,IAAI,EAAE;AAAlB,WAAD,CAArC;AAAkE,UAAA,QAAQ,EAAEG,UAA5E;AAAA,kCACE,QAAC,IAAD;AAAM,YAAA,IAAI,EAAC;AAAX;AAAA;AAAA;AAAA;AAAA,kBADF;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,eAIE,QAAC,MAAD;AAAQ,UAAA,OAAO,MAAf;AAAgB,UAAA,OAAO,EAAE,MAAMa,YAAY,EAA3C;AAA+C,UAAA,OAAO,EAAEb,UAAxD;AAAA,kCACE,QAAC,IAAD;AAAM,YAAA,IAAI,EAAC;AAAX;AAAA;AAAA;AAAA;AAAA,kBADF;AAAA;AAAA;AAAA;AAAA;AAAA,gBAJF;AAAA;AAAA;AAAA;AAAA;AAAA,cAHF;AAAA;AAAA;AAAA;AAAA;AAAA,YAzEF;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AAwFD,CA9RD;;GAAMb,S;;KAAAA,S;AAgSN,eAAeA,SAAf","sourcesContent":["import React, { useState, useEffect, createRef } from 'react';\nimport { PieChart } from 'react-minimal-pie-chart';\nimport { Segment, Container, Breadcrumb, List, Button, Modal, Header, Icon, Sticky, Ref, Input, Form } from \"semantic-ui-react\";\nimport { Redirect } from 'react-router-dom';\nimport { calculate, editDashboard, deleteDashboard, createCategory, updateCategory, deleteCategory, listScore } from '../api/score';\nimport CategoryEditor from '../components/CategoryEditor';\nimport CategoryScore from '../components/CategoryScore';\nimport CategoryScoreLabel from '../components/CategoryScoreLabel';\nimport urls from \"../utils/urls\";\nimport { v4 as uuidv4 } from 'uuid';\n\nconst copyData = data => (\n  {\n    ...data,\n    dashboard: { ...data.dashboard },\n    categoryResults: data.categoryResults.map(el => ({\n      ...el,\n      category: {\n        ...el.category,\n        metrics: [...el.category.metrics]\n      }\n    })),\n  }\n);\n\nconst Dashboard = ({ id }) => {\n  const contextRef = createRef();\n  const refToScroll = createRef();\n  const nameInputRef = createRef();\n  const formRef = createRef();\n  const [ scoreOptions, setScoreOptions ] = useState([]);\n  const [state, setState] = useState({\n    open: false,\n    redirect: false,\n    editing: false,\n    processing: false,\n    loading: true,\n    data: null,\n    viewData: null,\n    scrollRef: false,\n    removedCategories: [],\n  });\n  const { open, redirect, processing, data, viewData, loading, editing, scrollRef, removedCategories } = state;\n\n  const fetchScore = () => {\n    calculate(id)\n      .then(response => {\n        setState({ ...state, data: response.data, loading: false, processing: false, editing: false });\n      })\n      .catch(() => {\n        setState({ ...state, loading: false, processing: false, editing: false });\n      });\n  }\n\n  useEffect(() => {\n    fetchScore();\n    listScore().then(response => {\n      setScoreOptions(response.data);\n    });\n  }, []);\n\n  useEffect(() => {\n    if (scrollRef) {\n      refToScroll.current.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    }\n  }, [scrollRef]);\n\n  useEffect(() => {\n    if (!data) {\n      return;\n    }\n\n    setState({ ...state, viewData: copyData(data) });\n  }, [data]);\n\n  const handleDelete = () => {\n    setState({ ...state, processing: true });\n    Promise.all([\n      ...data.categoryResults.map(item => {\n        return deleteCategory(item.category.id);\n      }),\n      deleteDashboard(id),\n    ])\n      .then(() => {\n        setState({ ...state, redirect: urls.dashboards });\n      });\n  }\n\n  const handleRemoveCategory = (i) => {\n    const newCategories = [...state.viewData.categoryResults].map(el => {\n      if (el.category.order > i + 1) {\n        el.category.order--;\n      }\n\n      return el;\n    });\n\n    const removedCategory = newCategories.splice(i, 1)[0];\n    if (!removedCategory.category.isNew) {\n      removedCategories.push(removedCategory.category.id)\n      setState({\n        ...state,\n        viewData: {\n          ...viewData,\n          categoryResults: newCategories,\n        },\n        removedCategories,\n      });\n    }\n  }\n\n  const handleAddCategory = () => {\n    const newCategories = [...state.viewData.categoryResults].map(el => {\n      el.category.order++;\n      return el;\n    });\n    newCategories.unshift({\n      category: {\n        isNew: true,\n        id: uuidv4(),\n        dashboard: id,\n        name: \"\",\n        color: \"\",\n        weight: 0,\n        order: 1,\n        metrics: [],\n      },\n      value: 0,\n      total: 0,\n      metricResults: [],\n    })\n\n\n    setState({\n      ...state,\n      viewData: {\n        ...viewData,\n        categoryResults: newCategories,\n      },\n      scrollRef: 0,\n    });\n  }\n\n  const handleUpdate = async () => {\n    setState({ ...state, processing: true });\n    const newName = nameInputRef.current.inputRef.current.value;\n    const promises = viewData.categoryResults.map(result => {\n      const { isNew, ...category } = result.category;\n      if (isNew) {\n        return createCategory(category);\n      }\n\n      return updateCategory(category.id, category);\n    });\n\n    removedCategories.map(id => {\n      deleteCategory(id);\n    })\n\n    if (data.dashboard.name != newName) {\n      promises.push(editDashboard(id, newName));\n    }\n\n    try {\n      await Promise.all(promises);\n    } finally {\n      fetchScore();\n    }\n  }\n\n  const handleUpdateCancel = () => {\n    setState({ ...state, editing: false, viewData: copyData(data) });\n  }\n\n  const handleOrderUp = (i) => {\n    const newCategory = [...state.viewData.categoryResults];\n    newCategory[i].category.order--;\n    newCategory[i + 1].category.order++;\n    newCategory[i] = newCategory.splice(i - 1, 1, newCategory[i])[0];\n    setState({\n      ...state,\n      viewData: {\n        ...viewData,\n        categoryResults: newCategory,\n      },\n      scrollRef: i - 1,\n    });\n  };\n\n  const handleOrderDown = (i) => {\n    const newCategory = [...state.viewData.categoryResults];\n    newCategory[i].category.order++;\n    newCategory[i + 1].category.order--;\n    newCategory[i] = newCategory.splice(i + 1, 1, newCategory[i])[0];\n    setState({\n      ...state,\n      viewData: {\n        ...viewData,\n        categoryResults: newCategory,\n      },\n      scrollRef: i + 1,\n    });\n  };\n\n  const handleChangeCategory = (i, newData) => {\n    const newCategories = viewData.categoryResults;\n    newCategories[i] = {\n      ...newCategories[i],\n      category: {\n        ...newData,\n      },\n    };\n    setState({\n      ...state,\n      viewData: {\n        ...viewData,\n        categoryResults: [\n          ...newCategories\n        ]\n      }\n    })\n  };\n\n  return (\n    <Container>\n      {redirect && <Redirect to={redirect} />}\n      <Ref innerRef={contextRef}>\n        <Segment.Group>\n          <Sticky context={contextRef} offset={80}>\n            <Segment>\n              <Breadcrumb size=\"massive\" style={{ height: 36, lineHeight: 1.4 }}>\n                <Breadcrumb.Section href={urls.dashboards} >Painéis</Breadcrumb.Section>\n                <Breadcrumb.Divider />\n                <Breadcrumb.Section active>{id}</Breadcrumb.Section>\n              </Breadcrumb>\n              <span style={{ float: \"right\" }} hidden={editing}>\n                <Button icon=\"pencil\" basic onClick={() => setState({ ...state, editing: true })} />\n                <Button icon=\"trash\" basic onClick={() => setState({ ...state, open: true })} />\n              </span>\n              <span style={{ float: \"right\" }} hidden={!editing}>\n                <Button icon=\"cancel\" negative basic onClick={handleUpdateCancel} disabled={processing} />\n                <Button icon=\"check\" positive basic onClick={handleUpdate} loading={processing} />\n              </span>\n            </Segment>\n          </Sticky>\n          <Segment padded loading={loading || processing}>\n            {viewData && <>\n              <div style={{ display: \"flex\", alignItems: \"center\", flexDirection: \"column\", marginBottom: 50 }}>\n                {editing ?\n                  <Input name=\"name\" defaultValue={viewData.dashboard.name} style={{ flexGrow: 0, marginBottom: 8 }} ref={nameInputRef} />\n                  :\n                  <Header content={viewData.dashboard.name} size=\"huge\" textAlign=\"center\" as=\"h2\" />\n                }\n                <PieChart\n                  rounded\n                  lineWidth=\"20\"\n                  animate\n                  data={[{ value: viewData.value, color: 'blue', }]}\n                  totalValue={viewData.total}\n                  label={(props) => <CategoryScoreLabel key={id} {...props} color=\"blue\" header={viewData.value} subheader={`/ ${viewData.total}`} />}\n                  labelPosition={0}\n                  background=\"#bfbfbf\"\n                  lengthAngle={270}\n                  startAngle={135}\n                  viewBoxSize={[100, 87]}\n                  style={{ maxWidth: 250 }}\n                />\n              </div>\n              <Form ref={formRef}>\n                <List relaxed=\"very\">\n                  {editing && <List.Item style={{ display: \"flex\", justifyContent: \"center\" }}>\n                    <Button content=\"Adicionar categoria\" icon=\"plus\" primary basic labelPosition=\"left\" onClick={handleAddCategory} />\n                  </List.Item>}\n                  {viewData.categoryResults.map((result, i, arr) => result && (\n                    <List.Item key={result.category.id} style={{ paddingLeft: editing ? 0 : 80 }}>\n                      <Ref innerRef={i == scrollRef ? refToScroll : undefined} >\n                        <>\n                          {editing && <div style={{ paddingRight: 15, marginTop: 20, float: \"left\", display: \"flex\", flexDirection: \"column\", alignItems: \"center\" }}>\n                            <Button.Group>\n                              <Button icon=\"angle up\" onClick={() => handleOrderUp(i)} disabled={i == 0} />\n                              <Button.Or text={i + 1} />\n                              <Button icon=\"angle down\" onClick={() => handleOrderDown(i)} disabled={i == arr.length - 1} />\n                            </Button.Group>\n                            <Button icon=\"trash\" style={{ margin: 5 }} onClick={() => handleRemoveCategory(i)} />\n                          </div>}\n                          {editing ? <CategoryEditor data={result} onChange={data => handleChangeCategory(i, data)} options={scoreOptions} /> :\n                            <CategoryScore data={result} editable={editing} onEdit={() => handleClickEditCategory(i)} />}\n                        </>\n                      </Ref>\n                    </List.Item>\n                  ))}\n                </List>\n              </Form>\n            </>}\n          </Segment>\n        </Segment.Group>\n      </Ref>\n      <Modal open={open} size='tiny'>\n        <Header icon><Icon name='trash' />Remover Painel</Header>\n        <Modal.Content>Deseja excluir o Painel \"{id}\"</Modal.Content>\n        <Modal.Actions>\n          <Button basic onClick={() => setState({ ...state, open: false })} disabled={processing}>\n            <Icon name='remove' /> Cancelar\n          </Button>\n          <Button primary onClick={() => handleDelete()} loading={processing}>\n            <Icon name='checkmark' /> Sim\n          </Button>\n        </Modal.Actions>\n      </Modal>\n    </Container>\n  );\n}\n\nexport default Dashboard;\n"]},"metadata":{},"sourceType":"module"}